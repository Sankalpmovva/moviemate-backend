generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
}

model Accounts {
  Account_ID     Int       @id @default(autoincrement())
  First_Name     String?
  Last_Name      String?
  Email          String    @unique
  Account_Balance Decimal? @default(0.0)
  Created_At     DateTime? @default(now())
  Updated_At     DateTime? @updatedAt
  IsActive       Boolean   @default(true)
  IsAdmin        Boolean   @default(false)

  Auth_Providers Auth_Providers[]
  Bookings       Bookings[]
  Notifications  Notifications[]
  Verification_Codes Verification_Codes[]
}

model Auth_Providers {
  Provider_ID      Int      @id @default(autoincrement())
  User_ID          Int
  Provider_Name    String
  Provider_User_ID String?  
  Password_Hash    String?
  Created_At       DateTime? @default(now())
  Updated_At       DateTime? @updatedAt
  Is_Active        Boolean   @default(true)

  user Accounts @relation(fields: [User_ID], references: [Account_ID])
}

model Verification_Codes {
  Code_ID   Int      @id @default(autoincrement())
  User_ID   Int
  Purpose   String?
  Code      String?
  Sent_At   DateTime? @default(now())
  Expires_At DateTime?

  user Accounts @relation(fields: [User_ID], references: [Account_ID])
}

model Notifications {
  Notification_ID Int      @id @default(autoincrement())
  User_ID         Int
  Purpose         String?
  Message         String?
  Method          String?
  Sent_At         DateTime? @default(now())

  user Accounts @relation(fields: [User_ID], references: [Account_ID])
}

model Genres {
  Genre_ID Int    @id @default(autoincrement())
  Name     String

  Movies   Movies[]
}

model Movies {
  Movie_ID Int     @id @default(autoincrement())
  TMDB_ID  Int?    @unique
  Title    String
  Genre_ID Int
  Runtime  Int?
  Rating   Decimal?
  Added_At DateTime? @default(now())
  IsActive Boolean?  @default(true)

  genre  Genres   @relation(fields: [Genre_ID], references: [Genre_ID])
  Showtimes Showtimes[]
}

model Formats {
  Format_ID Int    @id @default(autoincrement())
  Name      String

  Showtimes Showtimes[]
}

model Languages {
  Language_ID Int    @id @default(autoincrement())
  Name        String

  ShowtimesAsLanguage Showtimes[] @relation("ShowtimeLanguage")
  ShowtimesAsCaptions Showtimes[] @relation("ShowtimeCaptions")
}

model Theaters {
  Theatre_ID Int    @id @default(autoincrement())
  Name       String
  Full_Address String?
  Street     String?
  City       String?
  Postal_Code String?
  Latitude  Float?
  Longitude Float?
  Website   String?

  Showtimes Showtimes[]
}

model Showtimes {
  Show_ID    Int      @id @default(autoincrement())
  Movie_ID   Int
  Theater_ID Int
  Show_Date  DateTime
  Start_Time DateTime
  End_Time   DateTime
  Price      Decimal
  Format_ID  Int
  Language_ID Int
  Captions_ID Int?
  Added_At   DateTime? @default(now())
  IsActive   Boolean? @default(true)

  movie    Movies   @relation(fields: [Movie_ID], references: [Movie_ID])
  theater  Theaters @relation(fields: [Theater_ID], references: [Theatre_ID])
  format   Formats  @relation(fields: [Format_ID], references: [Format_ID])
  language Languages @relation("ShowtimeLanguage", fields: [Language_ID], references: [Language_ID])
  captions Languages? @relation("ShowtimeCaptions", fields: [Captions_ID], references: [Language_ID])
  bookings Bookings[]
}

model Bookings {
  Booking_ID   Int      @id @default(autoincrement())
  Show_ID      Int
  User_ID      Int
  Booking_Date DateTime? @default(now())
  Tickets      Int
  Total_Price  Decimal
  Payment_Method String?
  Payment_Date DateTime?
  IsActive     Boolean? @default(true)

  show Showtimes @relation(fields: [Show_ID], references: [Show_ID])
  user Accounts  @relation(fields: [User_ID], references: [Account_ID])
}
